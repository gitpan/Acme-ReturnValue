[
   {
      "PPI" : "PPI::Statement::Sub",
      "bad" : "sub find {\n    my ( $self, $city, $country ) = @_;\n\n    if ( $countries->{ lc $country } ) {\n        $country = $countries->{ lc $country };\n    }\n\n    my $ua = $self->{ua};\n\n    my $search_url = URI->new(\"http://www.getty.edu/vow/TGNServlet\");\n    $search_url->query_param( 'english' => 'Y' );\n    $search_url->query_param( 'find'    => $city );\n    $search_url->query_param( 'place'   => undef );\n    $search_url->query_param( 'page'    => 1 );\n    $search_url->query_param( 'nation'  => $country );\n\n    my $request = HTTP::Request->new( 'GET', $search_url );\n    my $response = $ua->request($request);\n\n    if ( not $response->is_success ) {\n        croak(\"WWW::Gazetteer::Getty: City $city in $country not found\");\n        return;\n    }\n\n    my @cities;\n    my $content = $response->content;\n\n    my @bits = split /checkbox/, $content;\n\n    my @ids;\n    foreach my $bit (@bits) {\n        my ($id) = $bit =~ m{subjectid=(\\d+)};\n        next unless $id;\n        push @ids, $id;\n    }\n\n    foreach my $id (@ids) {\n\n        my $detail_url = URI->new(\"http://www.getty.edu/vow/TGNFullDisplay\");\n        $detail_url->query_param( 'english'   => 'Y' );\n        $detail_url->query_param( 'find'      => $city );\n        $detail_url->query_param( 'place'     => undef );\n        $detail_url->query_param( 'page'      => 1 );\n        $detail_url->query_param( 'nation'    => $country );\n        $detail_url->query_param( 'subjectid' => $id );\n\n        $request = HTTP::Request->new( 'GET', $detail_url );\n        $response = $ua->request($request);\n\n        if ( not $response->is_success ) {\n            croak(\"WWW::Gazetteer::Getty: City $city in $country not found\");\n            return;\n        }\n\n        $content = $response->content;\n\n        my ($latitude)\n            = $content\n            =~ m{Lat:\\s+([0-9.-]+)&nbsp;&nbsp;<I>decimal degrees</I>};\n        my ($longitude)\n            = $content\n            =~ m{Long:\\s+([0-9.-]+)&nbsp;&nbsp;<I>decimal degrees</I>};\n\n        push @cities,\n            {\n            city      => $city,\n            country   => $country,\n            latitude  => $latitude,\n            longitude => $longitude,\n            };\n    }\n    return wantarray ? @cities : \\@cities;\n}",
      "file" : "/var/tmp/arv_mddq38/WWW-Gazetteer-Getty-0.11/Getty.pm",
      "package" : "WWW::Gazetteer::Getty"
   }
]
