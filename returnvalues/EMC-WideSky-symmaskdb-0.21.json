[
   {
      "PPI" : "PPI::Statement::Sub",
      "bad" : "sub hex2dec {\n  my $hex=shift @_;\n\n  my @dec=unpack(C4C4, pack(H2H2,substr($hex,0,2),substr($hex,2,2)));\n  return($dec[0]*256+$dec[1]);\n}",
      "file" : "/var/tmp/arv_Ktny3m/EMC-WideSky-symmaskdb-0.21/Util.pm",
      "package" : "EMC::WideSky::Util"
   },
   {
      "PPI" : "PPI::Statement::Sub",
      "bad" : "sub parse_symmaskdb (@) {\n  my $db=shift;\n  my %r=@_;\n  my $p = new XML::Parser(Handlers => {Start => \\&handle_start,\n                                       End   => \\&handle_end,\n                                       Char  => \\&handle_char});\n  $fa_restrict=$r{fa}; $host_restrict=$r{host}; $hba_restrict=$r{hba}; $dev_restrict=$r{dev}; $wwn_restrict=$r{wwn};\n  if ($r{input}) {\n    open(DB,$r{input}) || die \"Can't open symmaskdb\\n\";\n  } else {\n    open(DB,'symmaskdb list database -out xml |') || die \"Can't open symmaskdb\\n\";\n  }\n  $p->parse(*DB);\n  sub handle_start {\n    my $p=shift @_;\n    my $el=shift @_;\n    my %att=@_;\n\n    if ($el eq 'Devmask_Database_Record') {\n      $att{director}=~ s/^FA-//;\n      $dir=\"$att{director}:$att{port}\";\n      $fa_read=1 if ($dir=~ /$fa_restrict/i || ! $fa_restrict)\n    }\n\n    if ($el eq 'Db_Record') {\n      if ($att{awwn_node_name}) { $host=$att{awwn_node_name} } else { $host=$att{originator_port_wwn} }\n      $host_read=1 if (($host=~ /$host_restrict/i || ! $host_restrict) && ($att{originator_port_wwn}=~ /$wwn_restrict/i || ! $wwn_restrict));\n      if ($att{awwn_port_name}) { $hba=\"$att{awwn_port_name}\" } else { $hba=\"$att{originator_port_wwn}\" }\n      $hba_read=1 if ($hba=~ /$hba_restrict/i || ! $hba_restrict);\n    }\n\n    if ($el eq 'Devices') {\n      if ($att{start_dev} && $att{end_dev}) {\n      if ($att{start_dev} eq $att{end_dev}) {\n        $dev_read=1 if ($att{start_dev}=~ /$dev_restrict/i || ! $dev_restrict );\n        $db->{$att{start_dev}}->{$dir}->{$host}->{$hba}=1 if ($fa_read && $host_read && $hba_read && $dev_read);\n      } else {\n        $att{start_dev}=\"0\" x (4-length($att{start_dev})).$att{start_dev};\n        $att{end_dev}=\"0\" x (4-length($att{end_dev})).$att{end_dev};\n\n        for ($i=&hex2dec($att{start_dev});$i<=&hex2dec($att{end_dev});$i++) {\n          my $dev=&dec2hex($i);\n          $dev_read=1 if ($dev=~ /$dev_restrict/i || ! $dev_restrict);\n          $db->{$dev}->{$dir}->{$host}->{$hba}=1 if ($fa_read && $host_read && $hba_read && $dev_read);\n        }\n      }\n      }\n      $dev_read=0;\n    }\n  }\n\n  sub handle_end {\n    my $p=shift @_;\n    my $el=shift @_;\n\n    if ($el eq 'Devmask_Database_Record') { $fa_read=0; }\n    if ($el eq 'Db_Record') { $host_read=0; $hba_read=0; }\n  }\n\n  sub handle_char {\n    my $p=shift @_;\n    my $str=shift @_;\n\n    print ' ' x $i.\"CHAR: $str\\n\" unless ($str=~ /^\\s+$/);\n  }\n\n}",
      "file" : "/var/tmp/arv_Ktny3m/EMC-WideSky-symmaskdb-0.21/symmaskdb.pm",
      "package" : "EMC::WideSky::symmaskdb"
   }
]
