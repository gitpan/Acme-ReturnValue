[
   {
      "PPI" : "PPI::Statement::Sub",
      "bad" : "sub _blackrock {\n    require Finance::QuoteTW::Blackrock;\n    return Finance::QuoteTW::Blackrock::fetch( $self, @_ );\n}",
      "file" : "/var/tmp/arv_NiLJGw/Finance-QuoteTW-0.08/lib/Finance/QuoteTW.pm",
      "package" : "Finance::QuoteTW"
   },
   {
      "PPI" : "PPI::Statement::Sub",
      "bad" : "sub fetch {\n\tmy $b = WWW::Mechanize->new;\n\tmy $response = $b->get('http://www.blackrock.com.tw/retail/mliiffunds/prices.aspx');\n\tmy $current_encoding = getCharset($response);\n\tmy $form = $b->form_name('frmImportant');\n\t$b->submit;\n\tmy @fund_type = qw/ae ee ge gs pe/;\n\tmy @result;\n\n\tforeach my $fund_type (@fund_type) {\n\t\t$b->get(\"http://www.blackrock.com.tw/retail/mliiffunds/prices.aspx?at=eq&g=$fund_type\");\n\n\t\tmy $te = HTML::TableExtract->new;\n\t\t$te->parse($b->content);\n\t\tmy @ts = $te->tables;\n\t\tmy @rows = $ts[0]->rows;\n\t\tshift @rows;\n\t\tmy $previous_name;\n\n\t\tforeach my $row (@rows) {\n\t\t\tmy @data = map { s/\\s+//g if $_; $_ } \n\t\t\t\t\t   map { from_to($_, $current_encoding, $self->{encoding}); $_ } @$row;\n\n\t\t\tif ($data[0]) {\n\t\t\t\t$previous_name = $data[0];\n\t\t\t} else {\n\t\t\t\t$data[0] = $previous_name;\n\t\t\t}\n\t\t\t$data[2] ||= '';\n\t\t\t$data[3] = join '/', reverse split /-/, $data[3];\n\n\t\t\tpush @result, {\n\t\t\t\tname     => $data[0],\n\t\t\t\tdate     => $data[3],\n\t\t\t\tnav      => $data[5],\n\t\t\t\tchange   => $data[6],\n\t\t\t\tcurrency => $data[4],\n\t\t\t\ttype     => $data[1] . $data[2],\n\t\t\t};\n\t\t}\n\t}\n\n\treturn @result;\n}",
      "file" : "/var/tmp/arv_NiLJGw/Finance-QuoteTW-0.08/lib/Finance/QuoteTW/Blackrock.pm",
      "package" : "Finance::QuoteTW::Blackrock"
   },
   {
      "PPI" : "PPI::Statement::Sub",
      "bad" : "sub fetch {\n\tmy $b = WWW::Mechanize->new;\n\tmy $response = $b->get('http://www.franklin.com.tw/1.FundIntro/1.3FundNet.asp');\n\tmy $current_encoding = getCharset($response);\n\tmy $date = $1 if $b->content =~ /(\\d+\\/\\d+\\/\\d+)/;\n\n\tmy $te = HTML::TableExtract->new(depth => 3);\n\t$te->parse($b->content);\n\tmy @result;\n\tmy @ts = $te->tables;\n\tforeach my $index (0..2) {\n\t\tmy @rows = $ts[$index]->rows;\n\t\tshift @rows;\n\n\t\tforeach my $row (@rows) {\n\t\t\tnext unless $row->[3] =~ /\\d+\\.\\d+/;\n\t\t\tmy @data = map { s/\\s+//g; $_ } @$row;\n\t\t\tfrom_to($data[0], $current_encoding, $self->{encoding});\n\t\t\t$data[5] =~ s/\\+//;\n\t\t\t$data[5] =~ s/^-$/0/;\n\n\t\t\tpush @result, {\n\t\t\t\tname     => $data[0],\n\t\t\t\tdate     => $date,\n\t\t\t\tnav      => $data[3],\n\t\t\t\tchange   => $data[5],\n\t\t\t\tcurrency => $data[2],\n\t\t\t\ttype     => $data[1],\n\t\t\t};\n\t\t}\n\t}\n\n\treturn @result;\n}",
      "file" : "/var/tmp/arv_NiLJGw/Finance-QuoteTW-0.08/lib/Finance/QuoteTW/Franklin.pm",
      "package" : "Finance::QuoteTW::Franklin"
   },
   {
      "PPI" : "PPI::Statement::Sub",
      "bad" : "sub fetch {\n\tmy $b = WWW::Mechanize->new;\n\tmy $response = $b->get('http://www.capitalfund.com.tw/jsp/fund08.jsp');\n\tmy $current_encoding = getCharset($response);\n\n\tmy $te = HTML::TableExtract->new;\n\t$te->parse($b->content);\n\n\tmy @ts = $te->tables;\n\tmy @result;\n\tmy @rows = $ts[8]->rows;\n\tshift @rows;\n\n\tforeach my $row (@rows) {\n\t\tnext unless $row->[1];\n\t\tmy @data = map { s/\\s+//g; $_ } @$row;\n\t\tmy $type = 'N/A';\n\t\tfrom_to($data[0], $current_encoding, $self->{encoding});\n\t\t$data[3] =~ s/\\+//;\n\n\t\tpush @result, {\n\t\t\tname     => $data[0],\n\t\t\tdate     => $data[1],\n\t\t\tnav      => $data[2],\n\t\t\tchange   => $data[3],\n\t\t\tcurrency => 'TWD',\n\t\t\ttype     => $type,\n\t\t};\n\t}\n\n\treturn @result;\n}",
      "file" : "/var/tmp/arv_NiLJGw/Finance-QuoteTW-0.08/lib/Finance/QuoteTW/Capital.pm",
      "package" : "Finance::QuoteTW::Capital"
   },
   {
      "PPI" : "PPI::Statement::Sub",
      "bad" : "sub fetch {\n\tmy $b = WWW::Mechanize->new;\n\tmy $response = $b->get('http://www.cathaysite.com.tw');\n\tmy $current_encoding = getCharset($response);\n\n\tmy $te = HTML::TableExtract->new;\n\t$te->parse($b->content);\n\n\tmy @ts = $te->tables;\n\tmy @result;\n\tmy @rows = $ts[13]->rows;\n\tshift @rows;\n\n\tforeach my $row (@rows) {\n\t\tnext unless $row->[1];\n\t\tmy @data = map { s/\\s+//g; $_ } @$row;\n\t\tmy $type = 'N/A';\n\t\tfrom_to($data[0], $current_encoding, $self->{encoding});\n\t\t$data[1] = ${[localtime]}[5] + 1900 . \"/$data[1]\";\n\t\t$data[3] =~ s/\\+//;\n\n\t\tpush @result, {\n\t\t\tname     => $data[0],\n\t\t\tdate     => $data[1],\n\t\t\tnav      => $data[2],\n\t\t\tchange   => $data[3],\n\t\t\tcurrency => 'TWD',\n\t\t\ttype     => $type,\n\t\t};\n\t}\n\n\treturn @result;\n}",
      "file" : "/var/tmp/arv_NiLJGw/Finance-QuoteTW-0.08/lib/Finance/QuoteTW/Cathay.pm",
      "package" : "Finance::QuoteTW::Cathay"
   },
   {
      "PPI" : "PPI::Statement::Sub",
      "bad" : "sub fetch {\n\tmy $b = WWW::Mechanize->new;\n\tmy $response = $b->get('http://www.iit.com.tw/Iitweb/NAV/FundNAVCurrentDate.aspx');\n\tmy $current_encoding = getCharset($response);\n\n\tmy $te = HTML::TableExtract->new;\n\t$te->parse($b->content);\n\n\tmy @ts = $te->tables;\n\tmy @result;\n\tmy @rows = $ts[1]->rows;\n\tshift @rows;\n\n\tforeach my $row (@rows) {\n\t\tmy @data = map { s/\\s+//g; $_ } @$row;\n\t\tmy $type = 'N/A';\n\t\tfrom_to($data[0], $current_encoding, $self->{encoding});\n\n\t\tif ($data[0] =~ /--(\\w)/) {\n\t\t\t$type = $1;\n\t\t}\n\n\t\tpush @result, {\n\t\t\tname     => $data[0],\n\t\t\tdate     => $data[1],\n\t\t\tnav      => $data[2],\n\t\t\tchange   => $data[3],\n\t\t\tcurrency => 'TWD',\n\t\t\ttype     => $type,\n\t\t};\n\t}\n\n\treturn @result;\n}",
      "file" : "/var/tmp/arv_NiLJGw/Finance-QuoteTW-0.08/lib/Finance/QuoteTW/Iit.pm",
      "package" : "Finance::QuoteTW::Iit"
   },
   {
      "PPI" : "PPI::Statement::Sub",
      "bad" : "sub fetch {\n\tmy $b = WWW::Mechanize->new;\n\tmy $response = $b->get('http://www.paradigm-fund.com/location.asp?oversea=0');\n\tmy $current_encoding = getCharset($response);\n\n\tmy $te = HTML::TableExtract->new;\n\t$te->parse($b->content);\n\n\tmy @ts = $te->tables;\n\tmy @result;\n\tmy @rows = $ts[0]->rows;\n\tshift @rows;\n\n\tforeach my $row (@rows) {\n\t\tmy @data = map { s/\\s+//g; $_ } @$row;\n\t\tfrom_to($data[0], $current_encoding, $self->{encoding});\n\t\t(my $change) = $data[3] =~ /([-]?\\d+(\\.\\d+)?)/;\n\t\tmy $date = [localtime]->[5] + 1900 . \"/$data[1]\";\n\t\t$date =~ s/\\W$//;\n\t\t$data[2] =~ s/\\W$//;\n\n\t\tpush @result, {\n\t\t\tname     => $data[0],\n\t\t\tdate     => $date,\n\t\t\tnav      => $data[2],\n\t\t\tchange   => $change,\n\t\t\tcurrency => 'TWD',\n\t\t\ttype     => 'N/A',\n\t\t};\n\t}\n\n\treturn @result;\n}",
      "file" : "/var/tmp/arv_NiLJGw/Finance-QuoteTW-0.08/lib/Finance/QuoteTW/Paradigm.pm",
      "package" : "Finance::QuoteTW::Paradigm"
   },
   {
      "PPI" : "PPI::Statement::Sub",
      "bad" : "sub fetch {\n\tmy %args = @_;\n\tmy $fund_type = $args{type} || '';\n\n\tmy $b = WWW::Mechanize->new;\n\tmy $response = $b->get('http://www.jpmrich.com.tw');\n\tmy $current_encoding = getCharset($response) || 'big5';\n\t$b->follow_link(n => 1);\n\n\tmy $url = \"http://www.jpmrich.com.tw/cgi-bin/jfonline/funds/fund_nav_detail.jsp?BV_SessionID=$1\"\n\t  if $b->content =~ /\\?BV_SessionID=([^\"]+)/;\n\t$b->get($url);\n\tmy $year = ${[localtime]}[5] + 1900;\n\n\tmy @result;\n\tforeach my $option (0..1) {\n\t\tnext if $fund_type eq 'onshore'  && $option == 0;\n\t\tnext if $fund_type eq 'offshore' && $option == 1;\n\t\tmy $form = $b->form_name('frmQuery');\n\t\tmy $input = $form->find_input('fund_corp');\n\t\t$input->{current} = $option;\n\t\t$b->submit;\n\n\t\tmy $te = HTML::TableExtract->new;\n\t\t$te->parse($b->content);\n\n\t\tmy @ts = $te->tables;\n\t\tmy @rows = $ts[0]->rows;\n\t\tshift @rows;\n\n\t\tforeach my $row (@rows) {\n\t\t\tnext unless $row->[1];\n\t\t\tmy @data = map { s/\\+//; $_ }\n\t\t\t\t\t   map { s/(\\d+\\/\\d+)/$year\\/$1/; $_ }\n\t\t\t\t\t   map { s/\\(([^)]+)\\)/$1/; $_ }\n\t\t\t\t\t   map { split /\\n/, $_ } @$row;\n\t\t\tmy $type = 'N/A';\n\t\t\tmy $currency = $data[1] =~ /([a-z]{3})/i ? $1 : 'TWD';\n\n\t\t\tif ( $current_encoding ne $self->{encoding} ) {\n\t\t\t\tfrom_to( $data[0], $current_encoding, $self->{encoding} );\n\t\t\t}\n\n\t\t\tpush @result, {\n\t\t\t\tname     => $data[0],\n\t\t\t\tdate     => $data[3],\n\t\t\t\tnav      => $data[2],\n\t\t\t\tchange   => $data[5],\n\t\t\t\tcurrency => $currency,\n\t\t\t\ttype     => $type,\n\t\t\t};\n\t\t}\n\t}\n\n\treturn @result;\n}",
      "file" : "/var/tmp/arv_NiLJGw/Finance-QuoteTW-0.08/lib/Finance/QuoteTW/Jpmrich.pm",
      "package" : "Finance::QuoteTW::Jpmrich"
   },
   {
      "PPI" : "PPI::Statement::Sub",
      "bad" : "sub fetch {\n\tmy $b = WWW::Mechanize->new;\n\tmy $response = $b->get('http://www.tisc.com.tw/tiim/netvalue/qry.jsp');\n\tmy $current_encoding = getCharset($response);\n\n\tmy $te = HTML::TableExtract->new;\n\t$te->parse($b->content);\n\n\tmy @ts = $te->tables;\n\tmy @result;\n\tmy @rows = $ts[0]->rows;\n\tshift @rows;\n\n\tforeach my $row (@rows) {\n\t\tmy @data = map { s/\\s+//g; $_ } @$row;\n\t\tmy $type = 'N/A';\n\t\tfrom_to($data[0], $current_encoding, $self->{encoding});\n\t\t$data[1] = ${[localtime]}[5] + 1900 . \"/$data[1]\";\n\t\t$data[3] =~ s/\\+//;\n\n\t\tif ($data[0] =~ /--(\\w)/) {\n\t\t\t$type = $1;\n\t\t}\n\n\t\tpush @result, {\n\t\t\tname     => $data[0],\n\t\t\tdate     => $data[1],\n\t\t\tnav      => $data[2],\n\t\t\tchange   => $data[3],\n\t\t\tcurrency => 'TWD',\n\t\t\ttype     => $type,\n\t\t};\n\t}\n\n\treturn @result;\n}",
      "file" : "/var/tmp/arv_NiLJGw/Finance-QuoteTW-0.08/lib/Finance/QuoteTW/Tisc.pm",
      "package" : "Finance::QuoteTW::Tisc"
   },
   {
      "PPI" : "PPI::Statement::Sub",
      "bad" : "sub fetch {\n\tmy $b = WWW::Mechanize->new;\n\tmy $response = $b->get('http://www.schroders.com.tw');\n\tmy $current_encoding = getCharset($response);\n\n\t$b->get('http://schroders.moneydj.com/w/js/wfundjs.djjs?aspid=schroder&showall=0');\n\tmy $html = $b->content;\n\tfrom_to($html, $current_encoding, $self->{encoding});\n\tmy $string = $1 if $html =~ /var wfund_fund=\"([^\"]+)\"/;\n\tmy %fund = splice @{[split /#/, $string]}, 2;\n\tmy @result;\n\n\tforeach my $key (keys %fund) {\n\t\tmy $url = \"http://schroders.moneydj.com/w/wb/wb02_${key}_4.djhtm\";\n\t\t$b->get($url);\n\t\tmy $html = $b->content;\n\n\t\tmy $te = HTML::TableExtract->new;\n\t\t$te->parse($html);\n\n\t\tmy @ts = $te->tables;\n\t\tmy $table = $ts[1];\n\n\t\t(my $today_nav = $table->cell(1,1))=~ s/,//g;\n\t\t(my $yesterday_nav = $table->cell(2,1)) =~ s/,//g;\n\t\tmy $change = sprintf \"%.4f\", $today_nav - $yesterday_nav;\n\n\t\tpush @result, {\n\t\t\tname     => $fund{$key},\n\t\t\tdate     => ${[localtime]}[5] + 1900 . '/' . $table->cell(1,0),\n\t\t\tnav      => $today_nav,\n\t\t\tchange   => $change,\n\t\t\tcurrency => 'N/A',\n\t\t\ttype     => 'N/A',\n\t\t};\n\t}\n\n\treturn @result;\n}",
      "file" : "/var/tmp/arv_NiLJGw/Finance-QuoteTW-0.08/lib/Finance/QuoteTW/Schroders.pm",
      "package" : "Finance::QuoteTW::Schroders"
   },
   {
      "PPI" : "PPI::Statement::Sub",
      "bad" : "sub fetch {\n\tmy $b = WWW::Mechanize->new;\n\tmy $response = $b->get(\n\t\t'http://www.allianzglobalinvestors.com.tw/frontend/' \n\t  . 'Taiwan_SITE/Chinese/Fund/Fund_Price/onshore/fundprice.csv'\n\t);\n\tmy $current_encoding = 'big5';\n\tmy @content = split /\\n+/, $b->content;\n\tmy @result;\n\n\tforeach my $line (@content) {\n\t\tmy @data = map { s/\\s+//g; $_ } split /,/, $line;\n\t\tmy $data_count = scalar @data;\n\t\tnext if $data_count != 6;\n\n\t\tfrom_to($data[3], $current_encoding, $self->{encoding});\n\t\t(my $nav) = $data[4] =~ /(\\d+(\\.\\d+)?)/;\n\n\t\tpush @result, {\n\t\t\tname     => $data[3],\n\t\t\tdate     => $data[5],\n\t\t\tnav      => $nav,\n\t\t\tchange   => 'N/A',\n\t\t\tcurrency => 'TWD',\n\t\t\ttype     => 'N/A',\n\t\t};\n\t}\n\n\treturn @result;\n}",
      "file" : "/var/tmp/arv_NiLJGw/Finance-QuoteTW-0.08/lib/Finance/QuoteTW/Allianz.pm",
      "package" : "Finance::QuoteTW::Allianz"
   }
]
