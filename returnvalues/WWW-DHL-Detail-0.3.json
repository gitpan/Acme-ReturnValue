[
   {
      "PPI" : "PPI::Statement::Sub",
      "bad" : "sub dhlcheck {\n\tmy $paketnummer = shift;\n\tmy $language = shift || 'de';\n\n\tmy @newdata;\n\tmy $data = get(\"http://nolp.dhl.de/nextt-online-public/set_identcodes.do?lang=$language&idc=$paketnummer\");\n\t$data =~ s/[\\n\\r]//g;\n\n\tmy($detail) = ($data =~ /<table border=\"0\" cellspacing=\"0\" class=\"full eventList\">.*<tbody>(.*?)<\\/tbody>/);\n\twhile($detail =~ /<tr>(.*?)<\\/tr>/ig){\n\t\tmy $detailone = $1;\n\t\tmy($datum) = ($detailone =~ /<td class=\"event_date\">\\s*.*?([^<>]+?)\\s*(?:h|Uhr).*?\\s*<\\/td>/);\n\n\t\tmy($ort) = ($detailone =~ /<td class=\"location\">.*?<div class=\"overflow\">\\s*(.*?)\\s*<\\/div>.*?<\\/td>/);\n\t\tmy($daten) = ($detailone =~ /<td class=\"status lasttd\">.*?<div class=\"overflow\">\\s*(.*?)\\s*<\\/div>.*?<\\/td>/);\n\t\tmy %details;\n\t\t$details{'datum'} = $datum;\n\t\t$details{'ort'} = $ort;\n\t\t$details{'daten'} = $daten;\n\t\tpush(@newdata,\\%details)\n\t}\n\tmy($Sendungsnummer) = ($data =~ /<div id=\"multicolliPieceCode\">\\s*(?:Sendungsnummer|Shipment number)\\s*(.*?)\\s*<\\/div>/);\n\tmy($last) = ($data =~ /<tr class=\"lastStatus\">(.*?)<\\/tr>/);\n\tmy($lastChange) = ($last =~ /<td>\\s*(?:Status from|Status vom) (.*?) (?:h|Uhr)\\s*<\\/td>/);\n\tmy($lastStatus) = ($last =~ /<div class=\"statusZugestellt\">(.*?)<\\/div>/);\n\tunless($lastStatus){\n\t\t$last =~ s/<td>(.*?)<\\/td>//;\n\t\t($lastStatus) = ($last =~ /<td>\\s*(.*?)\\s*<\\/td>/);\n\t}\n\n\tmy $peopleto1 = \"\";\n\tmy $peopleto2 = \"\";\n\tmy($lastdata) = ($data =~ /<tr><td class=\"explorer\">&nbsp;<\\/td>(.*?)<tr class=\"lastStatus\">/);\n\t($peopleto1) = ($lastdata =~ /<td>\\s*[^<]*\\s*<\\/td>\\s*<td>\\s*(.*?)\\s*<\\/td>/);\n\t($peopleto2) = ($lastdata =~ /<tr><td class=\"explorer\">&nbsp;<\\/td>.*?<td>\\s*[^<]*\\s*<\\/td>\\s*<td>\\s*(.*?)\\s*<\\/td>/);\n\t$peopleto1 =~ s/\\s\\s*/ /g if($peopleto1);\n\t$peopleto2 =~ s/\\s\\s*/ /g if($peopleto2);\n\tmy($Statusyet1) = ($data =~ /<div class=\"(?:greyprogressbar|greenprogressbar)\" style=\"[^\"]*\">(.*?)<\\/div>/s);\n\tmy($Statusyet) = ($Statusyet1 =~ /<span>(.*?)\\%<\\/span>/s);\n\n\tmy %statusyetm = (\n\t\tde => {\n\t\t\t0 => 'Kein Status',\n\t\t\t20 => 'Filiale / Sendung an DHL ï¿½bergeben',\n\t\t\t40 => 'Transport zum Paketzentrum',\n\t\t\t60 => 'Bearbeitung in Paketzentrum',\n\t\t\t80 => 'Zustellung',\n\t\t\t100 => 'Sendung wurde erfolgreich zugestellt'\n\t\t},\n\t\ten => {\n\t\t\t0 => 'No status',\n\t\t\t20 => 'Post Office / Shipment handed over to DHL',\n\t\t\t40 => 'Transport',\n\t\t\t60 => 'Processing in parcel sorting hub',\n\t\t\t80 => 'Delivery',\n\t\t\t100 => 'Shipment has been delivered successfully'\n\t\t}\n\t);\n\t$Statusyet = 0 unless($Statusyet);\n\n\treturn(\\@newdata,({\n\t\t'shipnumber' => $Sendungsnummer,\n\t\t'lastchange' => $lastChange,\n\t\t'laststatus' => $lastStatus,\n\t\t'status' => $Statusyet,\n\t\t'to' => $peopleto1,\n\t\t'from' => $peopleto2,\n\t\t'statustext' => $statusyetm{$language}{$Statusyet},\n\t\t})\n\t);\n}",
      "file" : "/var/tmp/arv_6KQBU2/WWW-DHL-Detail/Detail.pm",
      "package" : "WWW::DHL::Detail"
   }
]
