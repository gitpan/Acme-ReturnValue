[
   {
      "PPI" : "PPI::Statement::Sub",
      "bad" : "sub gencontent {\n    my $content = shift;\n    my @paragraphs = split(/\\n\\n\\n*/,$content);\n\n    foreach (@paragraphs) {\n\ts/^\\n+//s; s/\\s+\\n//s;\n\n\tmy $urlpattern = '(?:http|https|ftp)://(?:[^/\\[\\]:]+)(?::\\d+)?/[^\\|\\s\\[\\]\\(\\)\\<\\>]*';\n\tmy $emailpattern= '(?:[\\w\\d\\.-]+@[\\w\\d\\.-]+)';\n\n\tuse English;\n\tmy @lines = split /\\n/;\n\tmy $prefixed = 0;\n\tforeach(@lines) {\n\t    if(/$urlpattern/) {\n\t\tmy($pre,$post) = ($PREMATCH, $POSTMATCH);\n\t\tunless(($pre =~ /\\[/ && $post =~ /\\]/) ||\n\t\t       ($pre =~ /\\(/ && $post =~ /\\)/)) {\n\t\t    s{($urlpattern)}{[$1|$1]};\n\t\t}\n\t    } elsif (/$emailpattern/ ) {\n\t\tmy($pre,$post) = ($PREMATCH, $POSTMATCH);\n\t\tunless($pre =~ /\\[/ && $post =~ /\\]/) {\n\t\t    s{($emailpattern)}{[link:$1,mailto:$1]};\n\t\t}\n\t    }\n\t}\n\t$_ = join(\"\\n\", @lines);\n\n\ts{(?<!\\[)\\G([^\\[\\]]*?)&([^\\[\\]]*?)(?!\\])}{$1&amp;$2}g;\n\ts{(?<!\\[)\\G([^\\[\\]]*?)<([^\\[\\]]*?)(?!\\])}{$1&lt;$2}g;\n\ts{(?<!\\[)\\G([^\\[\\]]*?)>([^\\[\\]]*?)(?!\\])}{$1&gt;$2}g;\n\n\ts{\\[image:\\s*(.+?)\\s*\\]}{<img src=\"$1\"/>}ig;\n\ts{\\[link:\\s*(\\S+?)\\s*,\\s*(.+?)\\s*\\]}{<a href=\"$2\">$1</a>}ig;\n\ts{\\[(${urlpattern})\\|(.+?)\\]}{<a href=\"$1\">$2</a>}ig;\n\ts{([^\\s]+?)\\s*\\((${urlpattern})\\)}{<a href=\"$2\">$1</a>}ig;\n\n\ts{\\[(.+?)\\]}{$1}g;\n\n\t@lines = split /\\n/;\n\t$prefixed = 0;\n\tforeach(@lines) {\n\t    $prefixed++ if(/^\\s*[\\-\\.ox#@\\+=]\\s/);\n\t}\n\n\tif(($prefixed-1 == $#lines) && $#lines > 0) {\n\t    my $new_p;\n\t    foreach (@lines) {\n\t\ts{^\\s*[\\-\\.ox\\#@\\+=]\\s(.+)$}{<li>$1</li>};\n\t\t$new_p .= \"$_\\n\";\n\t    }\n\t    $_ = \"<ul>\\n${new_p}</ul>\";\n\t}\n    }\n\n    $content = '';\n    foreach (@paragraphs) {\n \tif (m/^\\s*</ && m/<\\/.+>\\s*$/) {\n\t    $content .= \"\\n$_\\n\";\n\t} else {\n            $content .= \"\\n<p>$_</p>\\n\"\n\t}\n    }\n\n    return $content;\n}",
      "file" : "/var/tmp/arv_rA0U8s/Kwiki-Outline2Html-0.02/lib/Kwiki/Outline2HTML.pm",
      "package" : "Kwiki::Outline2HTML"
   }
]
