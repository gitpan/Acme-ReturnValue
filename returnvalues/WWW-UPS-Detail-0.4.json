[
   {
      "PPI" : "PPI::Statement::Sub",
      "bad" : "sub upscheck {\n\tmy $paketnummer = shift;\n\tmy $language = shift || 'de';\n\n\tmy $lang;\n\tif($language eq \"de\"){\n\t\t$lang = '&Lang=ger';\n\t}\n\tmy @newdata;\n\tmy $firstdata1 = get(\"http://wwwapps.ups.com/ietracking/tracking.cgi?tracknum=$paketnummer&IATA=$language$lang\");\n\tmy($loc) = ($firstdata1 =~ /<input type=\"hidden\" name=\"loc\" value=\"([^\"]*)\"/);\n\tmy($hiddensession) = ($firstdata1 =~ /<INPUT name=\"HIDDEN_FIELD_SESSION\" type=\"HIDDEN\" value=\"([^\"]*)\">/);\n\tmy($detail) = ($firstdata1 =~ /<h2>Tracking Detail<\\/h2>(.*)<form name=\"detailForm\" action=\"https?:\\/\\/wwwapps.ups.com\\/WebTracking\\/detail\" method=\"post\">/s);\n\t$detail =~ s/[\\n\\r]//g;\n\t$detail =~ s/\\s\\s*/ /g;\n\tmy($paketnumber) = ($firstdata1 =~ /<input type=\"hidden\" name=\"trackNums\" value=\"([^\"]*)\">/);\n\tif(!defined($paketnumber) || ($paketnumber eq \"\")){\n\t\t($paketnumber) = ($detail =~ /<input type=\"hidden\" name=\"trackNums\" value=\"([^\"]+)\">/i);\n\t}\n\tmy($weight) = ($firstdata1 =~ /<dt><label(?> for=\"\"|)>(?>Gewicht|Weight):<\\/label><\\/dt>\\s*<dd>([^<]+)<\\/dd>/s);\n\tmy($service) = ($detail =~ /<dt><label(?> for=\"\"|)>Service:<\\/label><\\/dt>[^<]*<dd>([^<]*)<\\/dd>/s);\n\tif(!defined($service) || $service eq \"\" || $service !~ /\\w+/){\n\t\t($service) = ($firstdata1 =~ /<p><a href=\"[^\"]*\" class=\"service\">\\s*([^<]*)\\s*<\\/a><\\/p>/i);\n\t}\n\t$service =~ s/\\xAE//g;\n\tmy($type) = ($firstdata1 =~ /<dt><label(?> for=\"\"|)>(?:Typ|Type):<\\/label><\\/dt>\\s*<dd>([^<]*)<\\/dd>/);\n\tmy($deliveryto) = ($firstdata1 =~ /<dt>\\s*<label(?> for=\"\"|)>\\s*(?:Ausgeh&auml;ndigt an|Hinterlegt bei|Delivered\\s*To|To):\\s*<\\/label>\\s*<\\/dt>\\s*<dd>\\s*(?><strong>|)([^<]*)(?><\\/strong>|)\\s*<\\/dd>/i);\n\t$deliveryto =~ s/&nbsp;/ /g;\n\t$deliveryto =~ s/^\\s*//g;\n\t$deliveryto =~ s/\\s\\s*/ /g;\n\t$deliveryto =~ s/,\\s*/, /g;\n\tmy($location) = ($firstdata1 =~ /<dt>\\s*<label(?> for=\"\"|)>\\s*(?:Ort|Location|An|To):\\s*<\\/label>\\s*<\\/dt>\\s*<(?:dd|strong)>\\s*<(?:dd|strong)>\\s*([^<]+)\\s*<\\/(?:dd|strong)>\\s*<\\/(?:dd|strong)>/si);\n\t$location =~ s/&nbsp;/ /g;\n\t$location =~ s/\\s*$//g;\n\t$location =~ s/^\\s*//g;\n\tmy($deliveryon) = ($firstdata1 =~ /<dt><label(?> for=\"\"|)>\\s*(?:Zugestellt am|Delivered On):\\s*<\\/label>\\s*<\\/dt>\\s*<dd>([^<]*)<\\/dd>/i);\n\t$deliveryon =~ s/&nbsp;/ /g;\n\t$deliveryon =~ s/^\\s*//g;\n\t$deliveryon =~ s/\\s\\s*/ /g;\n\t$deliveryon =~ s/,\\s*/, /g;\n\tmy($billedon) = ($firstdata1 =~ /(?:in Rechnung gestellt am|Billed On):\\s*<\\/label>\\s*<\\/dt>\\s*<dd>([^<]*)<\\/dd>/i);\n\t$billedon =~ s/^\\s*//g;\n\t$billedon =~ s/\\s\\s*/ /g;\n\t$billedon =~ s/,\\s*/, /g;\n\tmy($signedby) = ($firstdata1 =~ /(?:Unterschrieben von|Signed\\s*By):\\s*<\\/label>\\s*<\\/dt>\\s*<d[dt]>([^<]*)<\\/d[dt]>/i);\n\t$signedby =~ s/[\\n\\r]//g;\n\t$signedby =~ s/^\\s*//g;\n\t$signedby =~ s/\\s\\s*/ /g;\n\t$signedby =~ s/,\\s*/, /g;\n\tmy($laststatus) = ($firstdata1 =~ /\"(?:st_del_de_de_pgx_hh_linkedText|st_del_en_us_pgx_hh_linkedText|infoAnchor btnIconR hozAnchor)\" (?:id|class)=\"(?:tt_spStatus|_pgx_hh_linkedText)\">\\s*([^<]*)\\s*<img/i);\n\tif(!defined($laststatus) || ($laststatus eq \"\")){\n\t\t($laststatus) = ($detail =~ /<div id=\"ttc_tt_spStatus\">\\s*<!-- cms: id=\"[^\">]*\" actiontype=\"0\" -->\\s*<h3>\\s*([^<]*)\\s*<\\/h3>/i);\n\t}\n\t$laststatus =~ s/^\\s*//g;\n\t$laststatus =~ s/\\s\\s*/ /g;\n\t$laststatus =~ s/,\\s*/, /g;\n\n\t$hiddensession =~ s/%([a-fA-F0-9][a-fA-F0-9])/pack(\"C\", hex($1))/eg;\n\tmy %post;\n\t$post{'HIDDEN_FIELD_SESSION'} = $hiddensession;\n\tif($language eq \"de\"){\n\t\t$post{'loc'} = 'de_DE';\n\t}else{\n\t\t$post{'loc'} = 'en_US';\n\t}\n\t$post{'datakey'} = 'line1';\n\t$post{'progressIsLoaded'} = 'N';\n\t$post{'shipmentsAreLoaded'} = 'N';\n\t$post{'showPkgProgress'} = 'false';\n\t$post{'showAsscShipments'} = 'false';\n\t$post{'showSpPkgProg'} = 'Paketfortschritt anzeigen';\n\tmy $ua = LWP::UserAgent->new;\n\tmy $response = $ua->post('http://wwwapps.ups.com/WebTracking/detail', \\%post );\n\tmy $data1 = $response->content;\n\n\tmy($data) = ($data1 =~ /<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" class=\"dataTable\">(.*?)<\\/table>/s);\n\t$data =~ s/[\\n\\r]//g;\n\n\tmy $lastort;\n\twhile($data =~ /<tr(.*?)<\\/tr>/ig){\n\t\tmy $detailone = $1;\n\n\t\tmy($ort,$datum,$zeit,$daten) = ($detailone =~ /<td[^>]*>([^<]*)<\\/td>\\s*<td[^>]*>([^<]*)<\\/td>\\s*<td[^>]*>([^<]*)<\\/td>\\s*<td[^>]*>([^<]*)<\\/td>/);\n\t\tnext unless($daten);\n\t\t$datum =~ s/\\s\\s*/ /g;\n\t\t$datum =~ s/^\\s*|\\s*$//g;\n\t\t$ort =~ s/\\s\\s*/ /g;\n\t\t$ort =~ s/^\\s*|\\s*$//g;\n\t\t$zeit =~ s/\\s\\s*/ /g;\n\t\t$zeit =~ s/^\\s*|\\s*$//g;\n\t\t$daten =~ s/\\s\\s*/ /g;\n\t\t$daten =~ s/^\\s*|\\s*$//g;\n\t\t$ort = $lastort unless($ort);\n\t\t$lastort = $ort;\n\t\tmy %details;\n\t\t$details{'datum'} = $datum . \" \" . $zeit;\n\t\t$details{'ort'} = $ort;\n\t\t$details{'daten'} = $daten;\n\t\tpush(@newdata,\\%details)\n\t}\n\n\treturn(\\@newdata,({\n\t\t'shipnumber' => $paketnumber,\n\t\t'weight' => $weight,\n\t\t'service' => $service,\n\t\t'type' => $type,\n\t\t'deliveryto' => $deliveryto,\n\t\t'deliveryon' => $deliveryon,\n\t\t'billedon' => $billedon,\n\t\t'location' => $location,\n\t\t'signedby' => $signedby,\n\t\t'laststatus' => $laststatus\n\t\t})\n\t);\n}",
      "file" : "/var/tmp/arv_VOVbJw/WWW-UPS-Detail/Detail.pm",
      "package" : "WWW::UPS::Detail"
   }
]
