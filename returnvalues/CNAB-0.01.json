[
   {
      "PPI" : "PPI::Statement::Sub",
      "bad" : "sub parse_cnab{\n\tmy @content = split(\"\\n\",shift @_); \n\tmy $output = shift @_; \n\t\n\tif(scalar @content == 0){ return 0; }\n\tif(!defined($output)){ return 0; }\n\t\n\tmy @records; \n\t\n\tmy $cnab_version; \n\tmy $file_type; \n\tmy $file_sequence; \n\tmy $batch_type; \n\tmy $total; \n\n\twhile ( $_ = shift @content){\n\t\tmy $line_type = substr($_,7,1); \n\t\tmy %record;\n\n\t\tif($line_type == 0){ \n\t\t\t$cnab_version = substr($_,163,3);\n\t\t\t$file_type = substr($_,142,1);\n\t\t\t$file_sequence = substr($_,157,6);\n\t\t\tnext;\n\t\t}elsif($line_type == 1){ \n\t\t\t$batch_type = substr($_,8,1);\n\t\t\tnext;\n\t\t}elsif($line_type == 5){ \n\t\t\tnext;\n\t\t}elsif($line_type == 9){ \n\t\t\t$total = substr($_,23,6);\n\t\t\t$total = ($total - 4)/2; \n\t\t\tnext;\n\t\t}\n\t\t\n\t\t%record->{\"bank_code\"} = substr($_,0,3);\n\t\t%record->{\"status_code\"} = substr($_,15,2); \n\t\t%record->{\"status_reason_code\"} = substr($_,213,10); \n\t\t%record->{\"bank_agency\"} = substr($_,17,5);\n\t\t%record->{\"bank_account\"} = substr($_,23,12);\n\t\t%record->{\"our_number\"} = substr($_,44,13);\n\t\t%record->{\"document_number\"} = substr($_,58,15);\n\t\t%record->{\"valid_date\"} = substr($_,73,8);\n\t\t%record->{\"value\"} = substr($_,81,13) .\".\". substr($_,94,2);\n\t\t%record->{\"currency_code\"} = substr($_,130,2);\n\t\t$_ = shift @content; \n\t\tif(substr($_,8,5) % 2 > 0){ return 0; } \n\t\t%record->{\"sequence\"} = substr($_,8,5)/2;\n\t\t%record->{\"value_interest\"} = substr($_,17,13) .\".\". substr($_,30,2);\n\t\t%record->{\"value_discount\"} = substr($_,32,13) .\".\". substr($_,45,2);\n\t\t%record->{\"value_discount2\"} = substr($_,47,13) .\".\". substr($_,60,2);\n\t\t%record->{\"value_payed\"} = substr($_,77,13) .\".\". substr($_,90,2);\n\t\t%record->{\"value_credited\"} = substr($_,92,13) .\".\". substr($_,105,2);\n\t\t%record->{\"date_payed\"} = substr($_,137,8);\n\t\t%record->{\"date_credited\"} = substr($_,145,8);\n\t\t\n\t\tpush @records, \\%record;\n\t}\n\t\n\tif($cnab_version ne \"030\"){ return 0; } \n\tif($file_type != 2){ return 0; } \n\tif(scalar @records <= 0) { return 0; } \n\tif($total != scalar @records){ return 0; } \n\t\n\t%{$output}->{\"sequence\"} = $file_sequence;\n\t@{%{$output}->{\"records\"}} = @records;\n\t\n\treturn 1;\n}",
      "file" : "/var/tmp/arv_6q8t15/CNAB/CNAB.pm",
      "package" : "CNAB"
   }
]
