[
   {
      "PPI" : "PPI::Statement::Sub",
      "bad" : "sub get_results\n{\n    my $self = shift;\n    my $loop_counter = 0;\n    my $results = [];\n\n    if($self->{'EXPORT'})\n    {\n        my $sql = 'SELECT '\n            . join(', ', map { $_->{'sql'} } @{$self->{'COLUMNS'}})\n            . ' ' . $self->{'SQL_FRAGMENT'};\n        my $sort = $self->{'PAGING_OBJECT'}->get_sort($self->{'DBH'}->{'Driver'}->{'Name'});\n\n        if($self->{'DEBUG'})\n        {\n            warn \"Executing SQL: $sql $sort\";\n        }\n\n        my $sth = $self->{'DBH'}->prepare(\"$sql $sort\");\n        $sth->execute();\n        $results = $sth->fetchall_arrayref;\n        $sth->finish;\n    }\n    elsif($self->{'MYSQL_MAJOR_VERSION'} >= 4)\n    {\n        my $sql = 'SELECT SQL_CALC_FOUND_ROWS '\n            . join(', ', map { $_->{'sql'} } @{$self->{'COLUMNS'}})\n            . ' ' . $self->{'SQL_FRAGMENT'};\n        my $sort = $self->{'PAGING_OBJECT'}->get_sort($self->{'DBH'}->{'Driver'}->{'Name'});\n        my $limit = $self->{'PAGING_OBJECT'}->get_limit($self->{'DBH'}->{'Driver'}->{'Name'});\n\n        if($self->{'DEBUG'})\n        {\n            warn \"Executing SQL: $sql $sort $limit\";\n        }\n\n        my $sth = $self->{'DBH'}->prepare(\"$sql $sort $limit\");\n        $sth->execute();\n        my ($count) = $self->{'DBH'}->selectrow_array('SELECT FOUND_ROWS() AS num');\n\n        my $status = $self->{'PAGING_OBJECT'}->num_results($count);\n\n        while(!$status && $count)\n        {\n            $limit = $self->{'PAGING_OBJECT'}->get_limit($self->{'DBH'}->{'Driver'}->{'Name'});\n\n            $sth->finish;\n\n            if($self->{'DEBUG'})\n            {\n                warn \"Executing SQL: $sql $sort $limit\";\n            }\n\n            $sth = $self->{'DBH'}->prepare(\"$sql $sort $limit\");\n            $sth->execute();\n            ($count) = $self->{'DBH'}->selectrow_array('SELECT FOUND_ROWS() AS num');\n\n            $status = $self->{'PAGING_OBJECT'}->num_results($count);\n\n            if(++$loop_counter == 3)\n            {\n                die \"Unrecoverable error -- is the result set changing?\";\n            }\n        }\n\n        while(my $href = $sth->fetchrow_hashref)\n        {\n            push @$results, $href;\n        }\n    }\n    elsif($self->{'MYSQL_MAJOR_VERSION'} < 4)\n    {\n        my $countsql = 'SELECT count(*) ' . $self->{'SQL_FRAGMENT'};\n\n        if($self->{'DEBUG'})\n        {\n            warn \"Executing SQL: $countsql\";\n        }\n\n        my $sth = $self->{'DBH'}->prepare(\"$countsql\");\n        $sth->execute();\n        my ($count) = $sth->fetchrow_array;\n        $sth->finish;\n\n        $self->{'PAGING_OBJECT'}->num_results($count);\n\n        my $sql = 'SELECT ' . join(', ', map { $_->{'sql'} } @{$self->{'COLUMNS'}}) . ' ' . $self->{'SQL_FRAGMENT'};\n        my $sort = $self->{'PAGING_OBJECT'}->get_sort($self->{'DBH'}->{'Driver'}->{'Name'});\n        my $limit = $self->{'PAGING_OBJECT'}->get_limit($self->{'DBH'}->{'Driver'}->{'Name'});\n\n        if($self->{'DEBUG'})\n        {\n            warn \"Executing SQL: $sql $sort $limit\";\n        }\n\n        $sth = $self->{'DBH'}->prepare(\"$sql $sort $limit\");\n        $sth->execute();\n\n        while(my $href = $sth->fetchrow_hashref)\n        {\n            push @{$results}, $href;\n        }\n    }\n    else\n    {\n        die \"this should never happen\";\n    }\n\n    return $results;\n}",
      "file" : "/var/tmp/arv_US6qJ9/HTML-ReportWriter-1.5.1/ReportWriter.pm",
      "package" : "HTML::ReportWriter"
   }
]
